import{Q as y,a as b,b as V,d as H,c as B,e as C}from"./QCard-BJTn01xf.js";import{x as J,a6 as R,U as k,f as Q,k as n,r as u,c as W,o as X,s as m,j as a,l as g,n as d,_ as Y,a3 as D,m as q,L as S}from"./index-UVWGSH4B.js";import{b as Z,c as $,d as aa,a as x,Q as E,C as U}from"./ClosePopup-B4n6yLXt.js";import{_ as ia}from"./_plugin-vue_export-helper-D3hUZgBM.js";import"./format-gU2brKPM.js";function oa(){return J(R)}const ea={setup(){const r=oa(),o=u([]),h=u([]),i=u(!0),v=u(!1),_=u(!1),e=u(!1),c=u(null),p=u({numero_habitacion:"",piso:"",tipo_habitacion_id:"",precio:""}),w=u(""),A=[{name:"numero_habitacion",label:"Número de Habitación",field:"numero_habitacion",align:"left"},{name:"piso",label:"Piso",field:"piso",align:"left"},{name:"tipo_habitacion",label:"Tipo de Habitación",field:"tipo_habitacion",align:"left"},{name:"precio",label:"Precio",field:"precio",align:"left"},{name:"acciones",label:"Acciones",field:"acciones",align:"center"}],f=async()=>{i.value=!0;const{data:l,error:t}=await m.from("habitaciones").select(`
        id,
        numero_habitacion,
        piso,
        tipo_habitacion_id,
        estado,
        tipos_habitacion:tipo_habitacion_id (tipo, precio)
      `);t?console.error("Error cargando habitaciones:",t):o.value=l.map(s=>({id:s.id,numero_habitacion:s.numero_habitacion,piso:s.piso,tipo_habitacion:s.tipos_habitacion.tipo,tipo_habitacion_id:s.tipo_habitacion_id,precio:s.tipos_habitacion.precio,estado:s.estado})).sort((s,O)=>s.numero_habitacion-O.numero_habitacion),i.value=!1},P=async()=>{const{data:l,error:t}=await m.from("tipos_habitacion").select("*");if(t){console.error("Error cargando tipos de habitación:",t);return}h.value=l},N=()=>{p.value={numero_habitacion:"",piso:"",tipo_habitacion_id:"",precio:""},v.value=!0},T=l=>{c.value={...l},_.value=!0},L=l=>{c.value=l,e.value=!0},j=async()=>{try{const l={numero_habitacion:p.value.numero_habitacion,piso:p.value.piso,tipo_habitacion_id:p.value.tipo_habitacion_id.id||p.value.tipo_habitacion_id};console.log("Datos de la nueva habitación:",l);const{error:t}=await m.from("habitaciones").insert([l]).single();if(t){t.code==="23505"?r.notify({type:"negative",message:"La habitación ya existe",icon:"las la-times-circle"}):(console.error("Error agregando habitación:",t),r.notify({type:"negative",message:"Error al agregar habitación",icon:"las la-times-circle"}));return}r.notify({type:"positive",message:"Habitación agregada exitosamente",icon:"las la-check-circle"}),v.value=!1,await f()}catch(l){console.error("Error agregando habitación:",l),r.notify({type:"negative",message:"Error al agregar habitación",icon:"las la-times-circle"})}},G=async()=>{try{const l={numero_habitacion:c.value.numero_habitacion,piso:c.value.piso,tipo_habitacion_id:c.value.tipo_habitacion_id.id||c.value.tipo_habitacion_id};console.log("Datos de la habitación editada:",l);const{error:t}=await m.from("habitaciones").update(l).eq("id",c.value.id);if(t){console.error("Error editando habitación:",t),r.notify({type:"negative",message:"Error al editar habitación",icon:"las la-times-circle"});return}const{error:s}=await m.from("tipos_habitacion").update({precio:c.value.precio}).eq("id",c.value.tipo_habitacion_id.id||c.value.tipo_habitacion_id);if(s){console.error("Error editando tipo de habitación:",s),r.notify({type:"negative",message:"Error al editar tipo de habitación",icon:"las la-times-circle"});return}r.notify({type:"positive",message:"Habitación editada exitosamente",icon:"las la-check-circle"}),_.value=!1,await f()}catch(l){console.error("Error editando habitación:",l),r.notify({type:"negative",message:"Error al editar habitación",icon:"las la-times-circle"})}},I=async l=>{try{const{error:t}=await m.from("habitaciones").delete().eq("id",l);if(t){console.error("Error borrando habitación:",t),r.notify({type:"negative",message:"Error al borrar habitación",icon:"las la-times-circle"});return}r.notify({type:"positive",message:"Habitación borrada exitosamente",icon:"las la-check-circle"}),e.value=!1,await f()}catch(t){console.error("Error borrando habitación:",t),r.notify({type:"negative",message:"Error al borrar habitación",icon:"las la-times-circle"})}},z=async l=>{try{const{error:t}=await m.from("habitaciones").update({estado:"inhabilitada"}).eq("id",l.id);if(t){console.error("Error inhabilitando habitación:",t),r.notify({type:"negative",message:"Error al inhabilitar habitación",icon:"las la-times-circle"});return}r.notify({type:"positive",message:"Habitación inhabilitada exitosamente",icon:"las la-check-circle"}),await f()}catch(t){console.error("Error inhabilitando habitación:",t),r.notify({type:"negative",message:"Error al inhabilitar habitación",icon:"las la-times-circle"})}},M=async l=>{try{const{error:t}=await m.from("habitaciones").update({estado:"disponible"}).eq("id",l.id);if(t){console.error("Error rehabilitando habitación:",t),r.notify({type:"negative",message:"Error al rehabilitar habitación",icon:"las la-times-circle"});return}r.notify({type:"positive",message:"Habitación rehabilitada exitosamente",icon:"las la-check-circle"}),await f()}catch(t){console.error("Error rehabilitando habitación:",t),r.notify({type:"negative",message:"Error al rehabilitar habitación",icon:"las la-times-circle"})}},F=l=>{const t=h.value.find(s=>s.id===l);t&&(p.value.precio=t.precio)},K=W(()=>w.value?o.value.filter(l=>Object.values(l).some(t=>String(t).toLowerCase().includes(w.value.toLowerCase()))):o.value);return X(async()=>{await f(),await P()}),{habitaciones:o,tiposHabitacion:h,loading:i,columns:A,dialogoAgregarVisible:v,dialogoEditarVisible:_,dialogoBorrarVisible:e,habitacionSeleccionada:c,nuevaHabitacion:p,search:w,filteredHabitaciones:K,abrirDialogoAgregar:N,abrirDialogoEditar:T,abrirDialogoBorrar:L,agregarHabitacion:j,editarHabitacion:G,borrarHabitacion:I,inhabilitarHabitacion:z,rehabilitarHabitacion:M,actualizarPrecio:F}}};function ta(r,o,h,i,v,_){return Q(),k(Z,{padding:""},{default:n(()=>[a(y,{class:"q-pa-md"},{default:n(()=>[a(b,null,{default:n(()=>o[12]||(o[12]=[g("div",{class:"text-h6"},"Gestión de Habitaciones",-1)])),_:1}),a(V),a(b,null,{default:n(()=>[a(d,{label:"Agregar Habitación",color:"primary",onClick:i.abrirDialogoAgregar},null,8,["onClick"]),a(H,{modelValue:i.search,"onUpdate:modelValue":o[0]||(o[0]=e=>i.search=e),placeholder:"Buscar",dense:"",outlined:"",class:"q-ml-md",debounce:"300"},{append:n(()=>[a(Y,{name:"las la-search"})]),_:1},8,["modelValue"])]),_:1}),a(b,null,{default:n(()=>[a($,{rows:i.filteredHabitaciones,columns:i.columns,"row-key":"id",dense:"",loading:i.loading,"loading-label":"Cargando habitaciones..."},{"body-cell-acciones":n(e=>[a(aa,{props:e},{default:n(()=>[a(d,{icon:"las la-edit",dense:"",flat:"",onClick:c=>i.abrirDialogoEditar(e.row)},null,8,["onClick"]),e.row.estado!=="inhabilitada"?(Q(),k(d,{key:0,icon:"las la-ban",dense:"",flat:"",color:"warning",onClick:c=>i.inhabilitarHabitacion(e.row)},null,8,["onClick"])):D("",!0),e.row.estado==="inhabilitada"?(Q(),k(d,{key:1,icon:"las la-check",dense:"",flat:"",color:"positive",onClick:c=>i.rehabilitarHabitacion(e.row)},null,8,["onClick"])):D("",!0),a(d,{icon:"las la-trash",dense:"",flat:"",color:"negative",onClick:c=>i.abrirDialogoBorrar(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])]),_:1})]),_:1}),a(x,{modelValue:i.dialogoAgregarVisible,"onUpdate:modelValue":o[5]||(o[5]=e=>i.dialogoAgregarVisible=e)},{default:n(()=>[a(y,null,{default:n(()=>[a(b,null,{default:n(()=>o[13]||(o[13]=[g("div",{class:"text-h6"},"Agregar Habitación",-1)])),_:1}),a(V),a(b,null,{default:n(()=>[a(B,{onSubmit:q(i.agregarHabitacion,["prevent"])},{default:n(()=>[a(H,{modelValue:i.nuevaHabitacion.numero_habitacion,"onUpdate:modelValue":o[1]||(o[1]=e=>i.nuevaHabitacion.numero_habitacion=e),label:"Número de Habitación",outlined:"",dense:""},null,8,["modelValue"]),a(E,{modelValue:i.nuevaHabitacion.piso,"onUpdate:modelValue":o[2]||(o[2]=e=>i.nuevaHabitacion.piso=e),label:"Piso",options:[1,2,3],outlined:"",dense:""},null,8,["modelValue"]),a(E,{modelValue:i.nuevaHabitacion.tipo_habitacion_id,"onUpdate:modelValue":[o[3]||(o[3]=e=>i.nuevaHabitacion.tipo_habitacion_id=e),i.actualizarPrecio],label:"Tipo de Habitación",options:i.tiposHabitacion,"option-label":"tipo","option-value":"id",outlined:"",dense:""},null,8,["modelValue","options","onUpdate:modelValue"]),a(H,{modelValue:i.nuevaHabitacion.precio,"onUpdate:modelValue":o[4]||(o[4]=e=>i.nuevaHabitacion.precio=e),label:"Precio",outlined:"",dense:"","prepend-icon":"las la-money-bill-wave",readonly:""},null,8,["modelValue"]),a(C,{align:"right"},{default:n(()=>[S(a(d,{flat:"",label:"Cancelar",color:"primary"},null,512),[[U]]),a(d,{flat:"",label:"Agregar",color:"primary",type:"submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(x,{modelValue:i.dialogoEditarVisible,"onUpdate:modelValue":o[9]||(o[9]=e=>i.dialogoEditarVisible=e)},{default:n(()=>[a(y,null,{default:n(()=>[a(b,null,{default:n(()=>o[14]||(o[14]=[g("div",{class:"text-h6"},"Editar Habitación",-1)])),_:1}),a(V),a(b,null,{default:n(()=>[a(B,{onSubmit:q(i.editarHabitacion,["prevent"])},{default:n(()=>[a(H,{modelValue:i.habitacionSeleccionada.numero_habitacion,"onUpdate:modelValue":o[6]||(o[6]=e=>i.habitacionSeleccionada.numero_habitacion=e),label:"Número de Habitación",outlined:"",dense:""},null,8,["modelValue"]),a(E,{modelValue:i.habitacionSeleccionada.piso,"onUpdate:modelValue":o[7]||(o[7]=e=>i.habitacionSeleccionada.piso=e),label:"Piso",options:[1,2,3],outlined:"",dense:""},null,8,["modelValue"]),a(E,{modelValue:i.habitacionSeleccionada.tipo_habitacion_id,"onUpdate:modelValue":o[8]||(o[8]=e=>i.habitacionSeleccionada.tipo_habitacion_id=e),label:"Tipo de Habitación",options:i.tiposHabitacion,"option-label":"tipo","option-value":"id",outlined:"",dense:""},null,8,["modelValue","options"]),a(C,{align:"right"},{default:n(()=>[S(a(d,{flat:"",label:"Cancelar",color:"primary"},null,512),[[U]]),a(d,{flat:"",label:"Guardar",color:"primary",type:"submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(x,{modelValue:i.dialogoBorrarVisible,"onUpdate:modelValue":o[11]||(o[11]=e=>i.dialogoBorrarVisible=e)},{default:n(()=>[a(y,null,{default:n(()=>[a(b,null,{default:n(()=>o[15]||(o[15]=[g("div",{class:"text-h6"},"Confirmar Borrado",-1)])),_:1}),a(V),a(b,null,{default:n(()=>o[16]||(o[16]=[g("div",null,"¿Estás seguro de que deseas borrar esta habitación?",-1)])),_:1}),a(C,{align:"right"},{default:n(()=>[S(a(d,{flat:"",label:"Cancelar",color:"primary"},null,512),[[U]]),a(d,{flat:"",label:"Borrar",color:"negative",onClick:o[10]||(o[10]=e=>i.borrarHabitacion(i.habitacionSeleccionada.id))})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const da=ia(ea,[["render",ta],["__scopeId","data-v-dc82bfd7"]]);export{da as default};
